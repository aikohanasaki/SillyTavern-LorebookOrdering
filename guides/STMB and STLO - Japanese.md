[ST Memory Books (STMB)へのリンク](https://github.com/aikohanasaki/SillyTavern-MemoryBooks) | [ST Lorebook Ordering (STLO)へのリンク](https://github.com/aikohanasaki/SillyTavern-LorebookOrdering)

# 🧠 究極の記憶ガイド：STMB + STLO

ST Memory Books (STMB) は**記憶コンテンツの生成**に不可欠であり、ST Lorebook Ordering (STLO) は**そのコンテンツがAIによって実際に使用されることを保証する**ために不可欠です。これらを組み合わせることで、**記憶の除外**という主要な問題を解決できます。

## ステップ1：舞台を整える（基礎）

**「均等にソート」を強制する：** まず、SillyTavern のデフォルト World Info (WI) 設定が STLO に制御を譲るようになっていることを確認してください。SillyTavern の**ワールド情報設定**で、**ワールド情報挿入戦略**を**「均等にソート」**に設定します。STLO は、SillyTavern の基本コードの厳格なカテゴリ並び替え（チャット → ペルソナ → など）をバイパスするためにこの戦略を必要とします。

## ステップ2：記憶コンテンツを作る（STMBの役割）

STMB を使って長期記憶を自動生成します。

1.  **自動要約を有効化：** STMBパネル（魔法の杖 🪄）を開き、**自動要約**を ON にします。希望する間隔（例：**30メッセージ**）を設定します。
2.  **メモリブックをバインド／作成：** チャットに記憶専用の Lorebook があることを確認してください。STMB は通常、グローバルタイプのブックに記憶を書き込みますが、簡便のためチャットにバインドされた Lorebook もよく使います。
3.  **通常通りチャット：** チャットが進行するにつれて、STMB は自動的に高密度かつ高品質な構造化サマリーを生成します。これらの記憶は、AI の限られたコンテキスト「フライト」に乗り込もうとする「乗客」です。

## ステップ3：優先順位の保証（STLOの役割）

これが最も重要なステップです。STLO を使って、**チャットにバインドされた STMBブック**の優先順位を手動で下げ、**キャラクターエッセンシャル**を優先します。

### A. 「チャット優先」トラップの回避
デフォルトでは、チャットバインドのメモリブックは**最優先**（チャット優先）になり、他のワールド・キャラクター・ペルソナ Lorebook を締め出してしまうリスクがあります。STLO で優先順位をカスタム値に再設定できます。

### B. 推奨される優先順位スタック

STLO で関連する全ての Lorebook にカスタム優先順位を設定しましょう。

### プライオリティ（優先度） vs ポジション（位置）の違い

**ポジション**は文脈内で*どこに*内容が現れるかを決めます（Char up, Char down, AN up/down, @D など）。  
**プライオリティ**は*どれだけ保護されるか*—文脈制限に達した時に何が残るかを決めます。

優先度の数字が大きいほど、トリミング（省略）されにくくなります。優先度は**各ポジションの中で**機能します。

---

### STLO 優先順位設定の推奨

| ロアブック／メモリ種別 | 推奨優先度 | 理由 |
|:--------------------|:-----------|:-----|
| **キャラクターエッセンシャル**（性格、説明、核となる特性） | **優先度5**（最高） | **最大限の保護。** キャラクターカード情報はボットのアイデンティティと行動の基盤。絶対に省略されてはならない。ポジションは通常ボット製作者が決定（Char/AN down または @D）。 |
| **ワールドロア**（世界設定、勢力、場所、ルール） | **優先度4**（高・上限あり） | **高いが制御可能な保護。** 世界観はボットの機能に不可欠。肥大化しないよう上限を設け、重要情報が失われないようにする。必要ならキャラクターエッセンシャルより先に削除。 |
| **ペルソナ**（あなた自身の情報） | **優先度3**（中） | **中程度の保護。** ユーザー情報は個別応答に重要だが、多少省略されてもボット機能は維持される。キャラクターや世界観よりは重要度が低い。 |
| **コマンド／一般指示** | **優先度3**（中） | **中程度の保護。** 一般的な振る舞いの指示や書式指定。応答品質には重要だが、キャラクター完全性ほどではない。@D で配置されることが多い。 |
| **記憶**（STMB、イベント再現） | **優先度1**（最低・上限あり） | **最小限の保護、積極的なトリミング。** 通常は Char up（文脈冒頭）に配置し、必須ではなく補助情報として扱う。多数の記憶が発火しても多くは安全に省略可能。上限設定で肥大化を防ぐ。 |

---

### 重要な原則

1. **不可逆なものを守る：** キャラクターエッセンシャルは失われると再現不可。
2. **肥大化しやすいものを予算管理：** ワールドロアや記憶は多数のエントリになるため上限必須。
3. **ポジションは独立：** 優先度1のアイテムが@Dにあっても一番下に置かれるだけ。文脈が満杯ならすぐ削除される。
4. **製作者の意図を信頼：** 優れたボットは、重要な指示を@Dに置く等、あなたの設定に関わらず意図通り配置。

---

## C. 予算上限の設定

- **キャラクターエッセンシャル**：無制限（通常は十分にコンパクト）
- **ワールドロア**：最大 15000〜25000 トークン
- **ペルソナ**：無制限（通常はコンパクト）
- **コマンド／一般**：無制限（通常はコンパクト）
- **記憶**：最大 5000〜15000 トークン（強力なトリミング）

1.  STMB Lorebook の STLO 設定を開きます。
2.  **予算**上限を設定します（例：**固定トークン数** `5000`、または **文脈のパーセンテージ** `15%`）。
3.  これにより、Lorebook が早期処理されても自動的に自身をトリミングし、優先度3, 2, 1 の Lorebook のためのスペースを残します。

---

**注意：** 一部の用語や技術的な説明は、日本語ネイティブまたは SillyTavern/STMB/STLO の用語に詳しい翻訳者によるチェックを推奨します。
