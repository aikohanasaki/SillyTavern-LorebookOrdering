[ST Memory Books (STMB)へのリンク](https://github.com/aikohanasaki/SillyTavern-MemoryBooks) | [ST Lorebook Ordering (STLO)へのリンク](https://github.com/aikohanasaki/SillyTavern-LorebookOrdering)

# 🧠 究極の記憶ガイド：STMB + STLO

ST Memory Books (STMB) は**記憶コンテンツの生成**に不可欠であり、ST Lorebook Ordering (STLO) は**そのコンテンツがAIによって実際に使用されることを保証する**ために不可欠です。これらを一緒に使用すると、**記憶の除外**という中心的な問題を解決します。

## ステップ1：舞台を整える（基礎）

**「均等にソート」を強制する：** まず、SillyTavernのデフォルトのワールド情報（WI）設定が、STLOが制御できるように設定されていることを確認する必要があります。SillyTavernの**ワールド情報設定**で、**ワールド情報挿入戦略**を**「均等にソート」**に設定してください。STLOは、SillyTavernの基本コードの厳格なカテゴリソート（チャット → ペルソナ → など）をバイパスするためにこの戦略を必要とします。

## ステップ2：記憶コンテンツを作成する（STMBの仕事）

STMBを使用して、長期記憶を自動的に作成します。

1.  **自動要約を有効にする：** STMBパネル（魔法の杖 🪄）に移動し、**自動要約**をオンにします。希望の間隔（例：**30メッセージ**）を設定します。
2.  **メモリブックをバインド/作成する：** チャットに記憶専用のLorebookがあることを確認してください。STMBは通常、記憶をグローバルタイプのブックに配置しますが、簡単にするためにチャットにバインドされたlorebookをよく使用します。
3.  **通常通りにチャットする：** チャットが進むにつれて、STMBは自動的に高密度で高品質な構造化された要約を生成します。これらの記憶は、AIの限られたコンテキストという「フライト」に乗り込もうとする「乗客」です。

## ステップ3：優先順位を保証する（STLOの仕事）

これが最も重要なステップです。STLOを使用して、**チャットにバインドされたSTMBブック**の優先順位を手動で下げ、**キャラクターの必須事項**を昇格させる必要があります。

### A. 「チャット優先」の罠を打ち破る
デフォルトでは、チャットにバインドされたメモリブックには**最高の優先順位**（チャット優先）が与えられ、コンテキストスペースを使いすぎて他のワールド、キャラクター、および/またはペルソナのlorebookを締め出すリスクがあります。STLOを使用すると、カスタムの特定の優先順位レベルを再割り当てすることで、これを修正できます。

### B. 推奨される優先順位スタック

STLOを使用して、関連するすべてのlorebookにカスタムの優先順位を設定します：

| Lorebook/記憶 | カスタムSTLO優先順位 | なぜ？（スタック） |
| :--- | :--- | :--- |
| **キャラクターの必須事項**（性格、説明） | **優先順位5**（最高） | **最初にロード**して、他のものがロードされる前にキャラクターの核となるアイデンティティと声を固定します。 |
| **STMBメモリブック**（あなたの記憶） | **優先順位4**（高） | **2番目にロード**。記憶が含まれることを保証するのに十分高いが、必須事項が最初にロードされることを保証するのに十分低い。 |
| **ペルソナの伝承**（あなたのアイデンティティ） | **優先順位3**（デフォルト/通常） | **3番目にロード**。ユーザーのアイデンティティ情報は、キャラクターのコア設定と重要な記憶の後に表示されます。 |
| **一般的/ランダムな伝承**（イベントの記憶、世界の伝承） | **優先順位1-2**（最低） | **最後にロード**。重要度の低い情報は、スペースが残っている場合にのみ含まれます。 |

### C. 予算上限を設定する
STMBメモリブック（およびその他の高密度なlorebook）については、STLOの**予算**機能を使用して、優先順位が高い場合でもすべてのスペースを消費するのを防ぎます。

1.  STMB lorebookのSTLO設定を開きます。
2.  **予算**上限（例：`5000`のような**固定トークン**、または`15%`のような**コンテキストの割合**）を設定します。
3.  これにより、lorebookが早期に処理された場合でも、容量上限を尊重して**自動的にトリミング**され、他のすべての優先順位3、2、および1のlorebookのためのスペースが確保されます。
