[連結至 ST 記憶書 (STMB)](https://github.com/aikohanasaki/SillyTavern-MemoryBooks) | [連結至 ST 知識庫排序 (STLO)](https://github.com/aikohanasaki/SillyTavern-LorebookOrdering)

# 🧠 終極記憶指南：STMB + STLO

ST 記憶書 (STMB) 對於**生成記憶內容**至關重要，而 ST 知識庫排序 (STLO) 則對於**確保這些內容被 AI 實際使用**至關重要。兩者結合使用時，能解決**記憶排斥**的核心問題。

## 步驟 1：奠定基礎

**強制「均勻排序」：** 請先確保 SillyTavern 的預設 World Info (WI) 設定允許 STLO 接管。在 SillyTavern **世界資訊設定**中，將**世界資訊插入策略**設為**「均勻排序」**。STLO 需要這策略以繞過 SillyTavern 基礎程式碼僵化的分類排序（聊天 → 角色卡 → 等）。

## 步驟 2：建立記憶內容（STMB 的職責）

用 STMB 自動生成您的長期記憶。

1.  **啟用自動摘要：** 打開 STMB 面板（魔法棒 🪄），開啟**自動摘要**。設定您偏好的間隔（如**30 則訊息**）。
2.  **綁定/建立記憶書：** 請確保您的聊天有專門用於記憶的知識庫。STMB 通常會將記憶放在全域型書籍，但為求簡便，常用聊天綁定的知識庫。
3.  **正常聊天：** 聊天進行時，STMB 會自動產生高密度、高品質、結構化的摘要。這些記憶就像試圖登上 AI 有限上下文「航班」的「乘客」。

## 步驟 3：保證優先級（STLO 的職責）

這是最關鍵的一步。必須用 STLO 手動降低**聊天綁定 STMB 書**的優先級，同時提升**角色核心設定**。

### A. 打破「聊天優先」陷阱
預設情況下，聊天綁定的記憶書有**最高優先級**（聊天優先），有機會佔據太多上下文空間，排擠其他世界、角色或用戶知識庫。STLO 允許您重新分配自訂優先級來解決。

### B. 推薦優先級順序

為所有相關知識庫設自訂優先級：

### 解釋優先級 vs 位置

**位置**決定內容於上下文中*出現的位置*（Char up、Char down、AN up/down、@D 等）。  
**優先級**決定*預算保護*—當上下文達上限時，哪些內容被保留。

優先級數字越高，越不容易被截斷。優先級**只在每個位置內**生效，非跨位置。

---

### STLO 優先級設定建議

| 知識庫/記憶類型 | 推薦優先級 | 說明 |
|:----------------------|:----------|:-----|
| **角色核心設定**（性格、描述、核心特質） | **優先級 5**（最高） | **最大保護。** 角色卡資訊是機器人身份與行為基礎。不可丟失或被截斷。位置多由機器人作者設定（Char/AN down 或 @D）。 |
| **世界知識**（設定、陣營、地點、規則） | **優先級 4**（高，設預算） | **高但可控保護。** 世界觀為機器人提供必要上下文，須設預算防膨脹，確保關鍵資訊不丟失。若需截斷，先於角色核心設定。 |
| **Persona**（您的身份） | **優先級 2-3**（中） | **中等保護。** 用戶身份資訊對個性化回應重要，但部分被截斷機器人仍可運作。較角色/世界設定優先級低。 |
| **指令/一般** | **優先級 2-3**（中） | **中等保護。** 行為指令及格式。對回應品質重要，尤其由機器人作者置於 @D，但不如角色完整性關鍵。 |
| **記憶**（STMB、回憶事件） | **優先級 1**（最低，設預算） | **最少保護，強力修剪。** 記憶應在 Char up（上下文前）作輔助資訊。若觸發多條記憶，大部分可安全截斷。預算防止記憶占據關鍵空間。 |

---

### 核心原則

1. **保護不可取代內容：** 角色核心設定遺失無法復原。
2. **給易膨脹內容設預算：** 世界知識與記憶可觸發多條，必須限制數量。
3. **位置獨立：** 優先級 1 項目在 @D 仍在底部，滿上下文時最先被截斷。
4. **信任機器人作者：** 好的機器人會將關鍵指令放在 @D，不受優先級設定影響。

---

## C. 設定預算上限

- **角色核心設定：** 無上限（通常很精簡）
- **世界知識：** 最多 15,000–25,000 權杖
- **Persona：** 無上限（通常精簡）
- **指令/一般：** 無上限（通常精簡）
- **記憶：** 最多 5,000–15,000 權杖（強力修剪）

1.  開啟 STMB 記憶書的 STLO 設定。
2.  設定**預算**上限（如**固定權杖** `5000` 或**上下文百分比** `15%`）。
3.  即使知識庫優先處理，也會自動修剪，給優先級 3、2、1 的知識庫預留空間。

---

**備註：** 一些術語及技術細節建議由熟悉 SillyTavern/STMB/STLO 的繁體中文母語者審校，以確保準確性與一致性。
