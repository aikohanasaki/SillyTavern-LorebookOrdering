[链接至 ST 记忆书 (STMB)](https://github.com/aikohanasaki/SillyTavern-MemoryBooks) | [链接至 ST 知识库排序 (STLO)](https://github.com/aikohanasaki/SillyTavern-LorebookOrdering)

# 🧠 终极记忆指南：STMB + STLO

ST 记忆书 (STMB) 对**生成记忆内容**至关重要，而 ST 知识库排序 (STLO) 则对**确保这些内容被 AI 实际使用**至关重要。当两者结合使用时，它们解决了**记忆排斥**的核心问题。

## 步骤 1：奠定基础 (The Foundation)

**强制“均匀排序”：** 您必须首先确保 SillyTavern 的默认世界信息 (WI) 设置已配置为允许 STLO 接管。在您的 SillyTavern **世界信息设置**中，将**世界信息插入策略**设置为**“均匀排序”**。STLO 需要此策略来绕过 SillyTavern 基础代码中僵化的类别排序（聊天 $\rightarrow$ 角色卡 $\rightarrow$ 等）。

## 步骤 2：创建记忆内容 (STMB 的工作)

使用 STMB 自动创建您的长期记忆。

1.  **启用自动摘要：** 前往 STMB 面板（魔术棒 🪄）并开启**自动摘要**。设置您偏好的间隔（例如，**30 条消息**）。
2.  **绑定/创建记忆书：** 确保您的聊天有一个专门用于记忆的知识库。STMB 通常会将记忆放置在全局类型的书中，但为了简单起见，通常会使用与聊天绑定的知识库。
3.  **正常聊天：** 随着聊天的进行，STMB 会自动生成密集、高质量、结构化的摘要。这些记忆现在就像是试图登上 AI 有限上下文“航班”的“乘客”。

## 步骤 3：保证优先级 (STLO 的工作)

这是最关键的一步。您必须使用 STLO 手动降低**与聊天绑定的 STMB 书**的优先级，同时提升您的**角色核心设定**。

### A. 打破“聊天优先”的陷阱
默认情况下，与聊天绑定的记忆书被赋予**最高优先级**（聊天优先），这有可能使其占用过多的上下文空间，并排斥其他世界、角色和/或角色卡知识库。STLO 允许您通过重新分配一个自定义的、特定的优先级来解决这个问题。

### B. 推荐的优先级堆栈

使用 STLO 为所有相关的知识库设置自定义优先级：

| 知识库/记忆 | 自定义 STLO 优先级 | 为什么？ (堆栈) |
| :--- | :--- | :--- |
| **角色核心设定** (性格, 描述) | **优先级 5** (最高) | **最先加载**，以在加载任何其他内容之前锁定核心角色身份和语调。 |
| **STMB 记忆书** (您的记忆) | **优先级 4** (高) | **第二加载**。足够高以确保记忆被包含，但又足够低以保证核心设定首先加载。 |
| **角色卡知识库** (您的身份) | **优先级 3** (默认/普通) | **第三加载**。在角色的核心设置和关键记忆之后看到用户信息。 |
| **通用/随机知识库** (事件记忆, 世界知识) | **优先级 1-2** (最低) | **最后加载**。不太重要的信息只有在还有剩余空间时才会被包含。 |

### C. 设置预算上限
对于 STMB 记忆书（以及任何其他密集的知识库），使用 STLO 的**预算**功能来防止其消耗所有空间，即使优先级很高。

1.  打开您的 STMB 知识库的 STLO 配置。
2.  设置一个**预算**上限（例如，**固定令牌数**如 `5000`，或**上下文百分比**如 `15%`）。
3.  这可以保证即使知识库被提前处理，它也会**自动修剪**以遵守您的容量上限，为所有其他优先级为 3、2 和 1 的知识库留出空间。
