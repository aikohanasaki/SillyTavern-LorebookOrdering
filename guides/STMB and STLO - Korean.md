[ST 메모리 북 (STMB) 링크](https://github.com/aikohanasaki/SillyTavern-MemoryBooks) | [ST 로어북 순서 지정 (STLO) 링크](https://github.com/aikohanasaki/SillyTavern-LorebookOrdering)

# 🧠 최고의 메모리 가이드: STMB + STLO

ST 메모리 북(STMB)은 **메모리 콘텐츠 생성**에 필수적이며, ST 로어북 순서 지정(STLO)은 **해당 콘텐츠가 AI에 의해 실제로 사용되도록 보장**하는 데 필수적입니다. 두 기능을 함께 사용하면 **메모리 제외**라는 핵심 문제를 해결할 수 있습니다.

## 1단계: 무대 설정 (기초)

**"균등 정렬" 강제:** 먼저 SillyTavern의 기본 World Info(WI) 설정이 STLO가 제어할 수 있게 되어야 합니다. SillyTavern **World Info 설정**에서 **World Info 삽입 전략**을 **"균등 정렬"**로 설정하세요. STLO는 이 전략이 필요하며, SillyTavern의 기본 코드의 엄격한 카테고리 정렬(채팅 → 페르소나 등)을 우회합니다.

## 2단계: 메모리 콘텐츠 만들기 (STMB의 역할)

STMB를 사용하여 장기 기억을 자동으로 만드세요.

1.  **자동 요약 활성화:** STMB 패널(마법 지팡이 🪄)로 이동하여 **자동 요약**을 켜세요. 원하는 간격(예: **30개 메시지**)을 설정합니다.
2.  **메모리 북 바인딩/만들기:** 채팅에 메모리 전용 로어북이 있는지 확인하세요. STMB는 일반적으로 전역 타입의 북에 메모리를 저장하지만, 단순화를 위해 채팅 바인딩 로어북도 자주 사용합니다.
3.  **정상적으로 채팅하기:** 채팅이 진행되면 STMB는 밀도 높고 고품질의 구조화된 요약을 자동으로 생성합니다. 이 메모리는 제한된 AI 컨텍스트 "비행"에 탑승하려는 "승객"입니다.

## 3단계: 우선순위 보장 (STLO의 역할)

가장 중요한 단계입니다. STLO를 이용해 **채팅 바인딩 STMB 북**의 우선순위를 수동으로 낮추고 **캐릭터 필수 요소**를 높이세요.

### A. "채팅 우선" 함정 깨기
기본적으로 채팅 바인딩 메모리 북에는 **최상위 우선순위**(채팅 우선)가 할당되어 과도한 컨텍스트 공간을 차지하고, 다른 월드/캐릭터/페르소나 로어북을 차단할 위험이 있습니다. STLO를 사용하면 사용자 지정 우선순위로 재할당할 수 있습니다.

### B. 권장 우선순위 스택

STLO로 모든 해당 로어북에 사용자 지정 우선순위를 할당하세요.

### 우선순위(Priority) vs 위치(Position) 설명

**위치(Position)**는 컨텍스트 내에서 *어디에* 콘텐츠가 위치하는지를 결정합니다(Char up, Char down, AN up/down, @D 등).  
**우선순위(Priority)**는 *예산 보호*—컨텍스트 한계에 도달했을 때 어떤 정보가 살아남는지를 결정합니다.

우선순위 숫자가 높을수록 트리밍(삭제)에서 더 보호받습니다. 우선순위는 **각 위치별로** 적용됩니다.

---

### STLO 우선순위 설정 권장안

| 로어북/메모리 종류 | 권장 우선순위 | 설명 |
|:-------------------|:-------------|:-----|
| **캐릭터 필수 요소** (성격, 설명, 핵심 특성) | **우선순위 5** (최상위) | **최대 보호.** 캐릭터 카드 정보는 봇의 정체성과 행동의 기반으로, 절대 잘려선 안 됩니다. 위치는 주로 봇 제작자가 Char/AN down 또는 @D로 설정합니다. |
| **월드 로어** (설정, 진영, 장소, 규칙) | **우선순위 4** (높음, 예산 한도) | **높으나 제어 가능.** 세계관은 봇 기능에 필수. 비대해지지 않게 제한을 두고, 핵심 정보가 사라지지 않도록 보호. 필요시 캐릭터 필수 요소 다음으로 트리밍. |
| **페르소나** (당신의 정보) | **우선순위 2-3** (중간) | **중간 보호.** 사용자 정체성 정보는 개인화된 응답에 중요하지만 일부가 잘려도 봇이 동작 가능. 캐릭터/월드보다 덜 중요. |
| **명령/일반 지시** | **우선순위 2-3** (중간) | **중간 보호.** 일반 행동 지시 및 포맷 명령. 응답 품질에 중요하지만 캐릭터 무결성만큼은 아님. 주로 @D에 위치. |
| **메모리** (STMB, 회상 이벤트) | **우선순위 1** (최하, 예산 한도) | **최소 보호, 과감한 트리밍.** 메모리는 Char up(컨텍스트 앞)에 배치하고 보조적 역할로 사용. 다수의 메모리가 활성화되면 대부분 안전하게 잘려도 봇이 망가지지 않음. 예산 한도로 메모리 비대화 방지. |

---

### 핵심 원칙

1. **대체 불가 정보 보호:** 캐릭터 필수 요소는 잃으면 복구 불가.
2. **비대화 위험 정보 예산 관리:** 월드 로어와 메모리는 많은 항목을 생성하므로 한도 설정 필수.
3. **위치는 독립적:** 우선순위 1 항목이 @D에 있어도 맨 아래에 위치할 뿐이고, 컨텍스트가 가득 차면 가장 먼저 삭제됨.
4. **봇 제작자 신뢰:** 우수한 봇은 중요한 지시를 @D에 배치 등, 우선순위와 무관하게 의도대로 배치함.

---

## C. 예산 한도 설정

- **캐릭터 필수 요소:** 한도 없음 (보통 충분히 짧음)
- **월드 로어:** 최대 15,000~25,000 토큰
- **페르소나:** 한도 없음 (보통 짧음)
- **명령/일반:** 한도 없음 (보통 짧음)
- **메모리:** 최대 5,000~15,000 토큰 (강력한 트리밍)

1.  STMB 로어북의 STLO 설정을 엽니다.
2.  **예산** 한도(예: **고정 토큰** `5000` 또는 **컨텍스트 비율** `15%`)를 지정하세요.
3.  이렇게 하면 로어북이 조기 처리되어도 자동으로 트리밍되어, 우선순위 3, 2, 1 로어북 공간이 확보됩니다.

---

**참고:** 일부 용어나 기술적 설명은 한국어 네이티브 및 SillyTavern/STMB/STLO 용어에 익숙한 번역가의 검토를 권장합니다.
