# 📚 로어북 순서 지정 (SillyTavern 확장 프로그램)

---

🌐 **한국어로 된 자세한 가이드도 참고하세요:**
👉 [STMB 및 STLO 가이드 (한국어)](../guides/STMB%20and%20STLO%20-%20Korean.md)

월드 정보에 로어북 수준의 우선순위 관리 및 예산 설정을 추가하는 SillyTavern 확장 프로그램입니다. 어떤 로어북을 먼저 활성화할지 완벽하게 제어하고 "욕심 많은" 로어북을 제한할 수 있습니다. 월드 정보 동작을 세밀하게 제어해야 하는 여러 로어북을 가진 사용자에게 적합합니다.

---

💡 **메모리 관리를 극대화하고 싶으신가요?**
최상의 결과를 위해 [SillyTavern-MemoryBooks (STMB)](https://github.com/aikohanasaki/SillyTavern-MemoryBooks)와 함께 STLO를 사용하세요!  
설정 팁과 메모리의 올바른 우선순위 지정에 대해서는 [STMB + STLO 가이드](../guides/STMB%20and%20STLO%20-%20Korean.md)를 참고하세요.

---

🆕 **이제 그룹 채팅에서 캐릭터별 재정의와 정확한 순서 조정을 지원합니다!**

**📋 [버전 내역 및 변경 로그](CHANGELOG.md)**

## 자주 묻는 질문
설정은 월드 정보 패널의 "로어북 순서 지정" 버튼을 통해 접근할 수 있습니다 (로어북이 사용 가능할 때 검색창 옆에 나타남).

![STLO Button](https://github.com/aikohanasaki/imagehost/blob/main/STLO.png)

---

## 📋 전제 조건

- **SillyTavern:** 1.13.5+ (최신 버전 권장)
- **월드 정보 전략:** STLO가 작동하려면 "균등하게" 삽입 전략을 사용해야 합니다
- **여러 로어북:** 우선순위를 정해야 하는 여러 로어북이 있을 때 가장 유용합니다

## 💡 권장 글로벌 월드 정보/로어북 활성화 설정
다음 설정으로 테스트되었습니다:

- **삽입 전략:** "균등하게" (STLO 작동에 필요)
- **최대 재귀 단계:** 2 (일반 권장 사항)

---

## 🚀 시작하기

### 1. **설치 및 구성**
- SillyTavern 확장 프로그램 폴더에 확장 프로그램을 설치합니다
- 여러 로어북을 사용할 수 있는지 확인합니다
- SillyTavern 설정에서 월드 정보 삽입 전략을 "균등하게"로 설정합니다

![Extension Button](https://github.com/aikohanasaki/imagehost/blob/main/settings.png)

### 2. **설정 접근**
- SillyTavern에서 월드 정보 패널을 엽니다
- 검색창 옆의 "로어북 순서 지정" 버튼을 찾습니다
- 클릭하여 로어북 관리 모달을 엽니다

### 3. **우선순위 구성**
- 드롭다운에서 로어북을 선택합니다
- 우선순위 수준을 설정합니다 (1=가장 낮음 ~ 5=가장 높음, 3=기본값)
- 원하는 경우 예산을 설정합니다
- 필요한 경우 순서 조정을 구성합니다
- 다른 로어북에 대해 저장하고 반복합니다

![Basic (global) settings](https://github.com/aikohanasaki/imagehost/blob/main/STLO%20basic.png)

---

## ⌨️ 슬래시 명령어: /stlo

채팅 입력에서 직접 특정 로어북에 대한 STLO 우선순위 및 예산 모달을 엽니다.

- 설명: 주어진 로어북에 대한 STLO 설정으로 빠르게 이동합니다.
- 사용법:
  ```
  /stlo <로어북 이름>
  ```
- 인수:
  - 로어북 이름 (대소문자를 구분하지 않음). 따옴표 없이 공백이 포함된 이름을 입력할 수 있으며, 따옴표는 선택 사항입니다.
- 예시:
  - `/stlo 내 로어북`
  - `/stlo "세계 로어"`
  - `/stlo 앨리스`

기능:
- 월드 정보 편집기에서 일치하는 로어북을 선택합니다.
- 해당 로어북에 대한 ST 로어북 순서 지정 모달을 엽니다.

참고:
- 기존 월드 정보 파일이 필요합니다. 선택/사용 가능한 파일이 없는 경우 "먼저 월드 정보 파일을 만들거나 선택하세요."라는 메시지가 표시됩니다.
- 이름이 어떤 로어북과도 일치하지 않으면 "로어북을 찾을 수 없음: 이름"이라는 메시지가 표시됩니다.
- 로어북 이름을 생략하면 "사용법: /stlo <로어북 이름>"이라는 사용 힌트가 표시됩니다.
- STLO는 순서 지정 및 예산이 적용되려면 여전히 "균등하게" 삽입 전략이 필요합니다.

---

## 🎯 우선순위 수준

### **우선순위 시스템**
- **가장 높음 (5):** 로어북 항목이 먼저 활성화되고 예산 할당에서 우선순위를 갖습니다
- **높음 (4):** 기본 우선순위보다 높음
- **기본값 (3):** 표준 SillyTavern 동작 (원본과 동일)
- **낮음 (2):** 기본 우선순위보다 낮음
- **가장 낮음 (1):** 로어북 항목이 마지막으로 활성화됩니다

### **작동 방식**
- 우선순위가 높은 로어북은 월드 정보 활성화 중에 먼저 처리됩니다
- "균등하게" 삽입 전략에서만 작동합니다

---

## 📊 순서 조정 시스템

### **우선순위를 넘어서는 미세 조정**
순서 조정 시스템을 사용하면 동일한 우선순위 수준 내에서 로어북 항목 처리 순서를 정밀하게 제어할 수 있습니다:

- **조정 범위:** 우선순위 계산에 -10,000 ~ +10,000 값 추가
- **정밀 제어:** 우선순위 수준을 변경하지 않고 처리 순서 미세 조정
- **수학 공식:** `최종 순서 = 우선순위 × 10,000 + 순서 조정 + 원래 항목 순서`

### **사용 예시**
```
로어북 A: 우선순위 3, 순서 조정 +250
로어북 B: 우선순위 3, 순서 조정 -100
로어북 C: 우선순위 3, 순서 조정 0 (기본값)

최종 처리 순서:
1. 로어북 A: 30,250 + 항목 순서 (먼저 처리)
2. 로어북 C: 30,000 + 항목 순서 (기본값)
3. 로어북 B: 29,900 + 항목 순서 (마지막으로 처리)
```

### **그룹 채팅 제어**
- **항상 적용:** 순서 조정은 단일 채팅 및 그룹 채팅 모두에서 작동합니다 (기본값)
- **그룹 채팅만:** 그룹 채팅 중에만 순서 조정을 적용하려면 이 옵션을 선택합니다
- **캐릭터 재정의:** 그룹 채팅의 특정 캐릭터에 대해 다른 순서 조정을 설정합니다

### **순서 조정을 사용해야 하는 경우**
- **캐릭터 대 월드:** 일반 월드 정보보다 캐릭터별 로어북을 약간 더 중요하게 설정
- **로어 계층 구조:** 보충 정보보다 중요한 로어 프로세스를 먼저 처리하도록 보장
- **메모리 관리:** 다른 콘텐츠에 비해 메모리/LTM 항목이 활성화되는 시점 미세 조정
- **대화 우선순위:** 대화 관련 로어북이 대화에서 활성화되는 시점 제어

---

## 🎭 그룹 채팅 캐릭터 재정의

![Group Chat Specific Settings](https://github.com/aikohanasaki/imagehost/blob/main/STLO%20group.png)

### **캐릭터별 맞춤 설정**
그룹 채팅에서 다른 캐릭터는 이제 개별 턴 동안 다른 로어북 동작을 가질 수 있습니다:

- **캐릭터별 우선순위:** Alice는 우선순위 5의 로어북을 사용할 수 있고, Bob은 동일한 로어북을 우선순위 2로 사용할 수 있습니다
- **개별 순서 조정:** 각 캐릭터는 동일한 로어북에 대해 사용자 지정 순서 조정 값을 가질 수 있습니다

### **그룹 채팅 재정의 작동 방식**
1. **재정의 구성:** 로어북 설정에서 "그룹 채팅 재정의" 섹션을 확장합니다
2. **캐릭터 선택:** 이 로어북에 대한 특별 설정을 받을 캐릭터를 선택합니다
3. **사용자 지정 값 설정:** 각 캐릭터는 고유한 우선순위 및 순서 조정 설정을 가질 수 있습니다
4. **자동 적용:** 그룹 채팅 중 Alice의 차례가 되면 그녀의 재정의 설정이 사용되고, Bob의 차례가 되면 그의 설정이 사용됩니다

### **시나리오 예시**
- **캐릭터 중심 로어북:** 캐릭터의 개인 로어북을 자신에게는 우선순위 5로, 다른 사람에게는 우선순위 1로 설정합니다
- **로어 전문화:** 학자 캐릭터는 학술 로어북에서 높은 우선순위를, 전사는 낮은 우선순위를 갖습니다
- **순서 미세 조정:** 긍정적인 순서 조정으로 캐릭터별 콘텐츠를 강화합니다

### **중요 참고 사항**
- **단일 채팅 동작:** 캐릭터 재정의는 단일 캐릭터 채팅에서 무시됩니다 (기본 로어북 설정 사용)
- **대체 논리:** 특정 재정의가 없는 캐릭터는 로어북의 기본 설정을 사용합니다
- **충돌 없음:** 그룹 채팅에서 단일 채팅으로 전환하면 재정의 상태가 자동으로 지워집니다

---


## ⚙️ 설정 및 구성

### **로어북별 설정**
- **우선순위:** 설명 레이블이 있는 1-5 스케일
- **순서 조정:** 우선순위 수준 내에서 처리 순서 미세 조정
- **예산 제어:** 각 로어북이 사용할 수 있는 월드 정보/컨텍스트 예산을 제한합니다.
  - **기본값:** 로어북별 제한 없음 (STLO 트리밍 없음); SillyTavern이 결정합니다. STLO는 항목 순서만 지정합니다.
  - **월드 정보 예산의 %:** 이 로어북을 월드 정보 토큰 풀의 백분율로 제한합니다.
  - **최대 컨텍스트의 %:** 모델의 최대 사용 가능 컨텍스트 창의 백분율로 제한합니다.
  - **고정 토큰:** 이 로어북에 대한 특정 토큰 제한을 설정합니다.
  - 예산은 `getMaxContextSize()`의 현재 컨텍스트 크기를 사용하여 계산되며, 적용하려면 "균등하게" 전략이 필요합니다.
  - **팁:** 기본값 (0)은 SillyTavern이 예산을 관리하도록 합니다. 1로 고정하면 로어북이 차단됩니다.
- **자동 저장:** 설정은 변경 시 자동으로 저장됩니다

### **전역 동작**
- **전략 유효성 검사:** "균등하게" 전략이 필요한지 자동으로 감지합니다
- **스마트 경고:** 실제 생성 중에만 호환성 경고를 표시합니다 (채팅 로드 시에는 표시 안 함)
- **생성 추적:** 자동 인사와 사용자가 시작한 생성을 구분합니다

---

## 🚨 호환성 및 경고

### **전략 요구 사항**
STLO가 작동하려면 "균등하게" 월드 정보 삽입 전략이 필요합니다. 확장 프로그램이 다음을 감지하면:
- 특수 로어북 설정이 구성됨
- 전략이 "균등하게"로 설정되지 않음

다음 옵션이 있는 경고 팝업이 표시됩니다:
- **생성 중지:** 설정을 먼저 수정하기 위해 생성을 중단합니다
- **STLO 비활성화:** 로어북 순서 지정 없이 계속합니다

### **모범 사례**
- STLO가 활성화되어 있을 때는 항상 "균등하게" 전략을 사용하십시오
- 먼저 짧은 대화로 우선순위 설정을 테스트하십시오
- 미세 조정을 위해 순서 조정을 드물게 사용하십시오

---

## 🔧 고급 사용법

### **다중 로어북 시나리오**
- **캐릭터 + 월드:** 캐릭터 로어북을 높음/가장 높음 우선순위로 설정
- **기억/LTM:** 기억을 가장 낮은 우선순위로 설정
- **순서 제어:** 우선순위 수준 내에서 세밀한 제어를 위해 순서 조정 사용

### **그룹 채팅 고급 전략**
- **캐릭터 전문화:** 각 캐릭터에게 관련 로어북에 높은 우선순위를 부여합니다
  - 학자: "마법 이론" 로어북에 높은 우선순위, "전투 전술"에 일반 우선순위
  - 전사: "전투 전술" 로어북에 높은 우선순위, "마법 이론"에 낮은 우선순위
- **순서 미세 조정:** 순서 조정을 사용하여 캐릭터별 콘텐츠를 강화합니다
  - 캐릭터별 로어북: 해당 캐릭터에 대해 +500 순서 조정
  - 일반 로어북: 0 순서 조정 (기본값)
- **로어 일관성:** 캐릭터별 정보가 해당 캐릭터의 턴에만 나타나도록 합니다
  - 캐릭터 배경 로어북을 해당 캐릭터에 대해 우선순위 5로, 다른 사람에게는 우선순위 1로 설정합니다

---

*Cline과 다양한 LLM으로 분위기 있게 코딩되었습니다.* 🎯✨
